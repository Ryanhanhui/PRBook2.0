<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>功能节点信息设置</legend>
</fieldset>
<div class="contentdiv-text contentdiv-block contentdiv-block-left">
    <div style="display: inline-block; width: 180px; padding: 10px; border: 1px solid #ddd; overflow: auto;">
        <ul id="NodeTree">

        </ul>
    </div>
</div>
<div class="contentdiv-text contentdiv-block contentdiv-block-right">

</div>
<script type="text/javascript">
    layui.use('layer', function () {
        var layer = layui.layer;
    });
    //请求树节点数据
    $.post("@Url.Action("GetNodeTreeData","NodeManage")",
            {},
            function (data, status) {
                if (status == "success") {
                    loadTree(data);
                }
                else {
                    layer.alert("网络连接超时", {
                        icon: 2,
                        closeBtn: false,
                        title: '警告'
                    });
                }
            }
            );
    //创建树节点
    var createNode = function (data) {
        var items = data;
        var nodearr = [];
        var index1 = 0;
        var index2 = 0;
        
        layui.each(items, function (i, nitem) {
            if (nitem.ParentNode == "") {
                debugger;
                var node = {
                    name: nitem.NodeName,
                    id: nitem.Id
                };
                nodearr.push(node);
                layui.each(items, function (j, citem) {
                    if (citem.ParentNode == nitem.Id) {
                        var child = [
                            {
                                name: citem.NodeName,
                                id: citem.Id
                            }
                        ];
                        node[index2].children = child;
                        index2 = index2 + 1;
                    }
                });
                index1 = index1 + 1;
            }
        });
        return nodearr;
    }
    function loadTree(data) {//初始化树节点
        layui.use('tree', function () {
            layui.tree({
                elem: '#NodeTree' //指定元素
            , target: '_blank' //是否新选项卡打开（比如节点返回href才有效）
            , click: function (item) { //点击节点回调
                layer.msg('当前节名称：' + item.name + '<br>全部参数：' + JSON.stringify(item));
                console.log(item);
            }
            , nodes: [ //节点
      {
          name: '常用文件夹'
        , id: 1
        , alias: 'changyong'
        , children: [
          {
              name: '所有未读（设置跳转）'
            , id: 11
            , href: 'http://www.layui.com/'
            , alias: 'weidu'
          }, {
              name: '置顶邮件'
            , id: 12
          }, {
              name: '标签邮件'
            , id: 13
          }
        ]
      }]
            });
        });
        
    }
</script>

