<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>功能节点信息设置</legend>
</fieldset>
<div class="contentdiv-text contentdiv-block contentdiv-block-left">
    <div style="display: inline-block; width: 180px; padding: 10px; border: 1px solid #ddd; overflow: auto;">
        <ul id="NodeTree">

        </ul>
    </div>
</div>
<div class="contentdiv-text contentdiv-block contentdiv-block-right">

</div>
<script type="text/javascript">
    layui.use('layer', function () {
        var layer = layui.layer;
    });
    //请求树节点数据
    $.post("@Url.Action("GetNodeTreeData","NodeManage")",
            {},
            function (data, status) {
                if (status == "success") {
                    loadTree(data);
                }
                else {
                    layer.alert("网络连接超时", {
                        icon: 2,
                        closeBtn: false,
                        title: '警告'
                    });
                }
            },
            "json"
            );
    //创建树节点
    var createNode = function (data) {
        var treearr = [];
        $.each(data, function (i) {
            if (data[i].ParentNode == null) {
                var child = [];
                $.each(data, function (j) {
                    if (data[j].ParentNode == data[i].Id) {
                        child.push({
                            name: data[j].NodeName,
                            Id: data[j].Id
                        });
                    }
                });
                treearr.push({
                    name: data[i].NodeName,
                    Id: data[i].Id,
                    children: child
                });
            }
        });
        return treearr;
    }
   
    function loadTree(data) {//初始化树节点
        layui.use('tree', function () {
            layui.tree({
                elem: '#NodeTree' //指定元素
            , target: '_blank' //是否新选项卡打开（比如节点返回href才有效）
            , click: function (item) { //点击节点回调
                layer.alert('当前节名称：' + item.name + '<br>全部参数：' + JSON.stringify(item));
            }
            , nodes: createNode(data)
            });
        });
        
    }
</script>

